- import_tasks: arch.yml
  when: ansible_os_family == "Archlinux"

- import_tasks: osx.yml
  when: ansible_os_family == "Darwin"

- name: Ensure /etc/shells includes {{ lookup('pipe', 'which zsh') }}
  become: true
  ansible.builtin.lineinfile:
    path: /etc/shells
    line: "{{ lookup('pipe', 'which zsh') }}"
    state: present

- name: Change shell to zsh
  become: true
  shell: chsh -s $(which zsh)
  when: lookup('pipe', 'echo $SHELL') != lookup('pipe', 'which zsh')
